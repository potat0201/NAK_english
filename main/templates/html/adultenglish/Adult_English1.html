{% load static %}
<!DOCTYPE html>
<html lang="en">
  {% include 'views/header.html' %}
  <style>
    .card-title{
      margin-top: 0px;
    }
  </style>
  <body>
    <!-- header -->
    {% include 'views/navbar.html' %}

    <!-- banner -->
    <div class="container">
      <img src="{%static 'img/img/bannerr2.png' %}" class="img-fluid banner1" alt="..." >
      <img src="{%static 'img/img/banneraldult.png' %}" class="img-fluid banner2" alt="..." >
    </div>
    <!-- phan noi dung tieng anh tre em -->
    <div class="container">
        <h1><strong>Adult's English - Basic Course</strong></h1>
        <div class="row row-cols-1 row-cols-md-3 g-4">
            <div class="col">
              <div class="card h-100">
                <img src="{%static 'img/img/unit1hello.png' %}" class="card-img-top" alt="...">
                <div class="card-body">
                  <h5 class="card-title">Unit 1: First Greetings
                  </h5>
                  <p class="card-text">
                    Học cách chào hỏi cho lần đầu tiên gặp ai đó<br>
                    Hello, Hi, I'm, Nice to meet you, ...
                  </p>
                </div>
              </div>
            </div>
            <div class="col">
              <div class="card h-100">
                <img src="{%static 'img/img/unit2greeting.png' %}" class="card-img-top" alt="...">
                <div class="card-body">
                  <h5 class="card-title">
                    Unit 2: Greetings and Farewell
                  </h5>
                  <p class="card-text">Học cách chào hỏi hằng ngày <br>
                  Good morning, Good afternoon, Good evening, How are you ?</p>
                </div>
              </div>
            </div>
            <div class="col">
              <div class="card h-100">
                <img src="{%static 'img/img/unit3introduce.png' %}" class="card-img-top" alt="...">
                <div class="card-body">
                  <h5 class="card-title">Unit 3: Introduce yourself</h5>
                  <p class="card-text">Học cách giới thiệu về bản thân như họ tên, nơi ở, độ tuổi, quê quán, ...</p>
                </div>
              </div>
            </div>
        </div>
    </div>
    <div class="container box">
        <div class="row row-cols-1 row-cols-md-3 g-4">
            <div class="col">
              <div class="card h-100">
                <img src="{%static 'img/img/unit4wedding.png' %}" class="card-img-top" alt="...">
                <div class="card-body">
                  <h5 class="card-title">Unit 4: Age and Marital Status
                  </h5>
                  <p class="card-text">
                    Học cách hỏi và trả lời về tuổi, tình trạng hôn nhân <br>
                    Are you married ? Yes I am
                  </p>
                </div>
              </div>
            </div>
            <div class="col">
              <div class="card h-100">
                <img src="{%static 'img/img/unit5jobs.png' %}" class="card-img-top" alt="...">
                <div class="card-body">
                  <h5 class="card-title">
                    Unit 5: Jobs and Workplaces
                  </h5>
                  <p class="card-text">Học cách hỏi và trả lời thông tin nghề nghiệp và nơi làm việc <br>
                  What's your job ? Where do you work ?</p>
                </div>
              </div>
            </div>
            <div class="col">
              <div class="card h-100">
                <img src="{%static 'img/img/unit6phonenum.png' %}" class="card-img-top" alt="...">
                <div class="card-body">
                  <h5 class="card-title">Unit 6: Phone numbers and email addresses
                    </h5>
                  <p class="card-text">Học cách hỏi và trả lời thông tin số điện thoại và email</p>
                </div>
              </div>
            </div>
        </div>
    </div>
    <div class="container box">
        <div class="row row-cols-1 row-cols-md-3 g-4">
            <div class="col">
              <div class="card h-100">
                <img src="{%static 'img/img/unit7family.png' %}" class="card-img-top" alt="...">
                <div class="card-body">
                  <h5 class="card-title">
                    Unit 7: Family
                  </h5>
                  <p class="card-text">
                    Học cách hỏi và trả lời thông tin về gia đình <br>
                    How many members in your family ? <br>
                    How many children do you have ?</p>
                  </p>
                </div>
              </div>
            </div>
            <div class="col">
              <div class="card h-100">
                <img src="{%static 'img/img/unit8dayoftheweek.png' %}" class="card-img-top" alt="...">
                <div class="card-body">
                  <h5 class="card-title">
                    Unit 8: Day and Dates
                  </h5>
                  <p class="card-text">Học cách hỏi về thứ ngày tháng <br>
                  What day is it today ? <br>
                  What's the date today ?</p>
                </div>
              </div>
            </div>
            <div class="col">
              <div class="card h-100">
                <img src="{%static 'img/img/unit9congratulation.png' %}" class="card-img-top" alt="...">
                <div class="card-body">
                  <h5 class="card-title">
                    Unit 9: Asking, Offering, Congratulations and wishes</h5>
                  <p class="card-text">Học cách giúp đỡ, cách xin phép, và cách chúc mừng <br>
                    Can I help you ? <br> Congratulations <br> Would you like to have a cup of coffee ?</p>
                  </p>
                </div>
              </div>
            </div>
        </div>
    </div>
    {% include 'views/footer.html' %}
  </body>
</html>
<style>
  body {
    margin: 0;
    font-family: "Roboto", sans-serif;
    background-color: #f5f7fa;
  }

  /* Container cho chatbot */
  .chatbot-container {
    position: fixed;
    bottom: 30px;
    right: 30px;
    z-index: 1000;
  }

  /* Nút chatbot */
  .chatbot-button {
    width: 70px;
    height: 70px;
    background: linear-gradient(135deg, #007bff, #0056b3);
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    font-size: 28px;
    animation: pulse 2s infinite;
  }

  .chatbot-button:hover {
    transform: scale(1.1);
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.4);
  }

  /* Hiệu ứng pulse */
  @keyframes pulse {
    0% {
      box-shadow: 0 0 0 0 rgba(234, 116, 225, 0.7);
    }
    70% {
      box-shadow: 0 0 0 10px rgba(0, 123, 255, 0);
    }
    100% {
      box-shadow: 0 0 0 0 rgba(0, 123, 255, 0);
    }
  }

  /* Khung chat */
  .chatbot-window {
    width: 350px;
    height: 500px;
    background: #fff;
    border-radius: 20px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    display: none;
    flex-direction: column;
    position: absolute;
    bottom: 100px;
    right: 0;
    overflow: hidden;
    transform: scale(0.8);
    opacity: 0;
    transition: transform 0.3s ease, opacity 0.3s ease;
  }

  .chatbot-container.active .chatbot-window {
    display: flex;
    transform: scale(1);
    opacity: 1;
  }

  /* Header khung chat */
  .chatbot-header {
    font-family: "Honk", sans-serif;
    background: linear-gradient(to right, rgb(143, 227, 161), #3498db);
    color: black;
    padding: 15px;
    text-align: center;
    font-size: 36px;
    font-weight: 500;
    border-top-left-radius: 20px;
    border-top-right-radius: 20px;
  }

  /* Nội dung khung chat */
  .chatbot-body {
    flex: 1;
    padding: 20px;
    overflow-y: auto;
    background: #f0f4ff;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  /* Tin nhắn */
  .message {
    padding: 10px 15px;
    border-radius: 15px;
    max-width: 75%;
    line-height: 1.4;
    animation: slideIn 0.3s ease;
    white-space: pre-wrap; /* Hỗ trợ xuống dòng */
  }

  .message.user {
    background: pink;
    color: black;
    margin-left: auto;
    border-bottom-right-radius: 5px;
  }

  .message.bot {
    background: #e9ecef;
    color: #333;
    margin-right: auto;
    border-bottom-left-radius: 5px;
  }

  /* Hiệu ứng tin nhắn xuất hiện */
  @keyframes slideIn {
    from {
      transform: translateY(20px);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }

  /* Footer chứa input */
  .chatbot-footer {
    padding: 15px;
    background: #fff;
    border-top: 1px solid #e0e0e0;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .chatbot-footer input {
    flex: 1;
    padding: 12px;
    border: 1px solid #ddd;
    border-radius: 25px;
    outline: none;
    font-size: 14px;
    transition: border-color 0.3s ease;
  }

  .chatbot-footer input:focus {
    border-color: linear-gradient(to right, rgb(143, 227, 161), #3498db);
  }

  .chatbot-footer button {
    padding: 12px;
    background: linear-gradient(to right, rgb(143, 227, 161), #3498db);
    color: white;
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.3s ease;
  }

  .chatbot-footer button:hover {
    background: linear-gradient(to right, rgb(143, 227, 161), #3498db);
  }

  .chatbot-button img {
    width: 70px;
    height: 70px;
    object-fit: contain;
    border-radius: 50%;
  }

  /* Responsive */
  @media (max-width: 480px) {
    .chatbot-window {
      width: 90vw;
      height: 80vh;
      bottom: 80px;
      right: 10px;
    }

    .chatbot-button {
      width: 60px;
      height: 60px;
      font-size: 24px;
    }
  }
</style>
<div class="chatbot-container">
  <div class="chatbot-button">
    <img
      src="{% static 'img/img/479374583_2408177479537942_8679824344704556172_n (1).png' %}"
      alt="logooo"
      class="loggonak"
      style=""
    />
  </div>
  <div class="chatbot-window">
    <div class="chatbot-header">NAK ENGLISH</div>
    <div class="chatbot-body" id="chatbot-body">
      <div class="message bot" style="white-space: normal">
        <strong>Xin chào! Cùng học tập với NAK ENGLISH nhé 🙂</strong>
      </div>
    </div>
    <div class="chatbot-footer">
      <input
        type="text"
        id="user-input"
        placeholder="Nhập câu hoặc câu hỏi..."
      />
      <button onclick="sendMessage()">📤</button>
    </div>
  </div>
</div>

<script>
  const API_KEY = "AIzaSyDoBLRfWtl8RgD9bP_0YLocv1Ek-joFt1o";
  const API_URL = `https://generativelanguage.googleapis.com/v1/models/gemini-1.5-flash:generateContent?key=${API_KEY}`;

  const SYSTEM_PROMPT =
    "Bạn là một giáo viên tiếng Anh chuyên nghiệp. Nhiệm vụ của bạn là giúp người dùng học tiếng Anh bằng cách giải thích từ vựng, ngữ pháp, sửa lỗi câu, cung cấp ví dụ và trả lời các câu hỏi liên quan đến tiếng Anh. Phản hồi của bạn phụ thuộc vào việc nếu người dùng nói tiếng việt hãy phản hồi tiếng việt và nói tiếng anh khi người dùng nói tiếng anh, không chấp nhận các ngôn ngữ khác, dễ hiểu và thân thiện. Mỗi ý chính hoặc bước giải thích phải được trình bày trên một dòng mới, sử dụng gạch đầu dòng ('-') hoặc xuống dòng để đảm bảo rõ ràng và dễ đọc.";

  document.querySelector(".chatbot-button").addEventListener("click", () => {
    document.querySelector(".chatbot-container").classList.toggle("active");
  });

  async function sendMessage() {
    const input = document.getElementById("user-input");
    const message = input.value.trim();
    if (!message) return;

    // Hiển thị tin nhắn người dùng
    const chatBody = document.getElementById("chatbot-body");
    const userMessage = document.createElement("div");
    userMessage.className = "message user";
    userMessage.textContent = message;
    chatBody.appendChild(userMessage);
    input.value = "";

    // Cuộn xuống cuối
    chatBody.scrollTop = chatBody.scrollHeight;

    try {
      // Gửi yêu cầu đến Gemini API
      const response = await fetch(API_URL, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          contents: [
            {
              parts: [{ text: SYSTEM_PROMPT }, { text: message }],
            },
          ],
        }),
      });

      if (!response.ok) {
        throw new Error("Lỗi khi gọi Gemini API");
      }

      const data = await response.json();
      const botReply = data.candidates[0].content.parts[0].text;

      // Hiển thị phản hồi của bot
      const botMessage = document.createElement("div");
      botMessage.className = "message bot";
      botMessage.textContent = botReply;
      chatBody.appendChild(botMessage);

      // Cuộn xuống cuối
      chatBody.scrollTop = chatBody.scrollHeight;
    } catch (error) {
      const errorMessage = document.createElement("div");
      errorMessage.className = "message bot";
      errorMessage.textContent = "Có lỗi xảy ra. Vui lòng thử lại!";
      chatBody.appendChild(errorMessage);
      console.error(error);
    }
  }

  // Gửi tin nhắn khi nhấn Enter
  document.getElementById("user-input").addEventListener("keypress", (e) => {
    if (e.key === "Enter") {
      sendMessage();
    }
  });
</script>