{% load static %}
<!DOCTYPE html>
<link
    href="{% static 'css/childrenenglish/childeng.css' %}"
    rel="stylesheet"
  />
<html lang="en">
  {% include 'views/header.html' %}
  <style>
    .messi:hover {
      color: blue;
    }
  </style>
  <body>
    <!-- header -->
    {% include 'views/navbar.html' %}
    <!-- banner -->
    <div class="container">
      <img src=" {% static 'img/img/bannerr2.png' %}" class="img-fluid banner1" alt="..." >
      <img src="{% static 'img/img/bannerr3.png' %}" class="img-fluid banner2" alt="..." >
    </div>
    <!-- phan noi dung tieng anh tre em -->
    <div class="container">
        <h1><strong>Children's English</strong></h1>
        <div class="row row-cols-1 row-cols-md-3 g-4">
            <div class="col">
              <a class="card h-100" href="/unit1" style="text-decoration: none">
                <img src="{% static 'img/img/hello.jpg' %}" class="card-img-top" alt="...">
                <div class="card-body">
                  
                  <h5 class="card-title" style="margin-top: 0px">Unit 1: Hello <br>
                    Hello, how are you ?
                  </h5>
                  <p class="card-text">
                    Học cách chào hỏi mọi người xung quanh
                  </p>
                </div>
              </a>
            </div>
            <div class="col">
              <a class="card h-100"  href="/unit2" style="text-decoration: none">
                <img src="{% static 'img/img/whatisyourname.jpg' %}" class="card-img-top" alt="...">
                <div class="card-body">
                  <h5 class="card-title" style="margin-top: 0px">
                    Unit 2: What is your name ? <br>
                    My name is NAK
                  </h5>
                  <p class="card-text">Học cách giới thiệu tên của bạn</p>
                </div>
              </a>
            </div>
            <div class="col">
              <a class="card h-100" href="/unit3" style="text-decoration: none">
                <img src="{% static 'img/img/thisis.jpg' %}" class="card-img-top" alt="...">
                <div class="card-body">
                  <h5 class="card-title" style="margin-top: 0px">Unit 3: This is apple</h5>
                  <p class="card-text">Học cách giới thiệu các vật dụng xung quanh</p>
                </div>
              </a>
            </div>
        </div>
    </div>
    <div class="container box">
        <div class="row row-cols-1 row-cols-md-3 g-4">
            <div class="col">
              <a class="card h-100" href="/unit4" style="text-decoration: none">
                <img src="{% static 'img/img/howoldreu.jpg' %}" class="card-img-top" alt="...">
                <div class="card-body">
                  <h5 class="card-title" style="margin-top: 0px">Unit 4: How old are you ?<br>
                    I am 10 years old
                  </h5>
                  <p class="card-text">
                    Học cách hỏi tuổi của mọi người như thầy cô, bạn bè, những người trong gia đình, ...
                  </p>
                </div>
              </a>
            </div>
            <div class="col">
              <a class="card h-100" href="/unit5" style="text-decoration: none">
                <img src="{% static 'img/img/school.png' %}" class="card-img-top" alt="...">
                <div class="card-body">
                  <h5 class="card-title" style="margin-top: 0px">
                    Unit 5: What's your school name ?<br>
                    It is NAK
                  </h5>
                  <p class="card-text">Học cách miêu tả về trường học của bạn</p>
                </div>
              </a>
            </div>
            <div class="col">
              <a class="card h-100" href="/unit6" style="text-decoration: none">
                <img src="{% static 'img/img/do-dung-hoc-tap.jpg' %}" class="card-img-top" alt="...">
                <div class="card-body">
                  <h5 class="card-title" style="margin-top: 0px">
                    Unit 6: What's this ? <br>
                    This is a erase</h5>
                  <p class="card-text">Học cách miêu tả các đồ dùng học tập</p>
                </div>
              </a>
            </div>
        </div>
    </div>
    <div class="container box">
        <div class="row row-cols-1 row-cols-md-3 g-4">
            <div class="col">
              
              <a class="card h-100" href="/unit7" style="text-decoration: none">
                <img src="{% static 'img/img/do-dung-hoc-tap.jpg' %}" class="card-img-top" alt="...">
                <div class="card-body">
                  <h5 class="card-title" style="margin-top: 0px">
                    Unit 7: What color is it ?<br>
                    It is red
                  </h5>
                  <p class="card-text">
                    Học cách miêu tả màu sắc của các vật dụng xung quanh
                  </p>
                </div>
              </a>
            </div>
            <div class="col">
              
              <a class="card h-100" href="/unit8" style="text-decoration: none">
                <img src="{% static 'img/img/breaktime.png' %}" class="card-img-top" alt="...">
                <div class="card-body">
                  <h5 class="card-title" style="margin-top: 0px">
                    Unit 8: What do you do at break time ?<br>
                    I play football
                  </h5>
                  <p class="card-text">Học cách miêu tả các hoạt động trong giờ giải lao, các hoạt động cuối tuần</p>
                </div>
              </a>
            </div>
            <div class="col">
              <a href="/unit9" style="text-decoration: none">
                <div class="card h-100 messi">
                  <img src="{% static 'img/img/fam.jpg' %}" class="card-img-top" alt="...">
                  <div class="card-body">
                    <h5 class="card-title" style="margin-top: 0px;">
                      Unit 9: This is my family.</h5>
                    <p class="card-text">Giới thiệu về gia đình của bạn cho những người mới quen, những người xung quanh</p>
                    </p>
                  </div>
                </div>
              </a>
            </div>
        </div>
    </div>
  {% include 'views/footer.html' %}
  </body>
</html>
<style>
  body {
    margin: 0;
    font-family: "Roboto", sans-serif;
    background-color: #f5f7fa;
  }

  /* Container cho chatbot */
  .chatbot-container {
    position: fixed;
    bottom: 30px;
    right: 30px;
    z-index: 1000;
  }

  /* Nút chatbot */
  .chatbot-button {
    width: 70px;
    height: 70px;
    background: linear-gradient(135deg, #007bff, #0056b3);
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    font-size: 28px;
    animation: pulse 2s infinite;
  }

  .chatbot-button:hover {
    transform: scale(1.1);
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.4);
  }

  /* Hiệu ứng pulse */
  @keyframes pulse {
    0% {
      box-shadow: 0 0 0 0 rgba(234, 116, 225, 0.7);
    }
    70% {
      box-shadow: 0 0 0 10px rgba(0, 123, 255, 0);
    }
    100% {
      box-shadow: 0 0 0 0 rgba(0, 123, 255, 0);
    }
  }

  /* Khung chat */
  .chatbot-window {
    width: 350px;
    height: 500px;
    background: #fff;
    border-radius: 20px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    display: none;
    flex-direction: column;
    position: absolute;
    bottom: 100px;
    right: 0;
    overflow: hidden;
    transform: scale(0.8);
    opacity: 0;
    transition: transform 0.3s ease, opacity 0.3s ease;
  }

  .chatbot-container.active .chatbot-window {
    display: flex;
    transform: scale(1);
    opacity: 1;
  }

  /* Header khung chat */
  .chatbot-header {
    font-family: "Honk", sans-serif;
    background: linear-gradient(to right, rgb(143, 227, 161), #3498db);
    color: black;
    padding: 15px;
    text-align: center;
    font-size: 36px;
    font-weight: 500;
    border-top-left-radius: 20px;
    border-top-right-radius: 20px;
  }

  /* Nội dung khung chat */
  .chatbot-body {
    flex: 1;
    padding: 20px;
    overflow-y: auto;
    background: #f0f4ff;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  /* Tin nhắn */
  .message {
    padding: 10px 15px;
    border-radius: 15px;
    max-width: 75%;
    line-height: 1.4;
    animation: slideIn 0.3s ease;
    white-space: pre-wrap; /* Hỗ trợ xuống dòng */
  }

  .message.user {
    background: pink;
    color: black;
    margin-left: auto;
    border-bottom-right-radius: 5px;
  }

  .message.bot {
    background: #e9ecef;
    color: #333;
    margin-right: auto;
    border-bottom-left-radius: 5px;
  }

  /* Hiệu ứng tin nhắn xuất hiện */
  @keyframes slideIn {
    from {
      transform: translateY(20px);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }

  /* Footer chứa input */
  .chatbot-footer {
    padding: 15px;
    background: #fff;
    border-top: 1px solid #e0e0e0;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .chatbot-footer input {
    flex: 1;
    padding: 12px;
    border: 1px solid #ddd;
    border-radius: 25px;
    outline: none;
    font-size: 14px;
    transition: border-color 0.3s ease;
  }

  .chatbot-footer input:focus {
    border-color: linear-gradient(to right, rgb(143, 227, 161), #3498db);
  }

  .chatbot-footer button {
    padding: 12px;
    background: linear-gradient(to right, rgb(143, 227, 161), #3498db);
    color: white;
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.3s ease;
  }

  .chatbot-footer button:hover {
    background: linear-gradient(to right, rgb(143, 227, 161), #3498db);
  }

  .chatbot-button img {
    width: 70px;
    height: 70px;
    object-fit: contain;
    border-radius: 50%;
  }

  /* Responsive */
  @media (max-width: 480px) {
    .chatbot-window {
      width: 90vw;
      height: 80vh;
      bottom: 80px;
      right: 10px;
    }

    .chatbot-button {
      width: 60px;
      height: 60px;
      font-size: 24px;
    }
  }
</style>
<div class="chatbot-container">
  <div class="chatbot-button">
    <img
      src="{% static 'img/img/479374583_2408177479537942_8679824344704556172_n (1).png' %}"
      alt="logooo"
      class="loggonak"
      style=""
    />
  </div>
  <div class="chatbot-window">
    <div class="chatbot-header">NAK ENGLISH</div>
    <div class="chatbot-body" id="chatbot-body">
      <div class="message bot" style="white-space: normal">
        <strong>Xin chào! Cùng học tập với NAK ENGLISH nhé 🙂</strong>
      </div>
    </div>
    <div class="chatbot-footer">
      <input
        type="text"
        id="user-input"
        placeholder="Nhập câu hoặc câu hỏi..."
      />
      <button onclick="sendMessage()">📤</button>
    </div>
  </div>
</div>

<script>
  const API_KEY = "AIzaSyDoBLRfWtl8RgD9bP_0YLocv1Ek-joFt1o";
  const API_URL = `https://generativelanguage.googleapis.com/v1/models/gemini-1.5-flash:generateContent?key=${API_KEY}`;

  const SYSTEM_PROMPT =
    "Bạn là một giáo viên tiếng Anh chuyên nghiệp. Nhiệm vụ của bạn là giúp người dùng học tiếng Anh bằng cách giải thích từ vựng, ngữ pháp, sửa lỗi câu, cung cấp ví dụ và trả lời các câu hỏi liên quan đến tiếng Anh. Phản hồi của bạn phụ thuộc vào việc nếu người dùng nói tiếng việt hãy phản hồi tiếng việt và nói tiếng anh khi người dùng nói tiếng anh, không chấp nhận các ngôn ngữ khác, dễ hiểu và thân thiện. Mỗi ý chính hoặc bước giải thích phải được trình bày trên một dòng mới, sử dụng gạch đầu dòng ('-') hoặc xuống dòng để đảm bảo rõ ràng và dễ đọc.";

  document.querySelector(".chatbot-button").addEventListener("click", () => {
    document.querySelector(".chatbot-container").classList.toggle("active");
  });

  async function sendMessage() {
    const input = document.getElementById("user-input");
    const message = input.value.trim();
    if (!message) return;

    // Hiển thị tin nhắn người dùng
    const chatBody = document.getElementById("chatbot-body");
    const userMessage = document.createElement("div");
    userMessage.className = "message user";
    userMessage.textContent = message;
    chatBody.appendChild(userMessage);
    input.value = "";

    // Cuộn xuống cuối
    chatBody.scrollTop = chatBody.scrollHeight;

    try {
      // Gửi yêu cầu đến Gemini API
      const response = await fetch(API_URL, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          contents: [
            {
              parts: [{ text: SYSTEM_PROMPT }, { text: message }],
            },
          ],
        }),
      });

      if (!response.ok) {
        throw new Error("Lỗi khi gọi Gemini API");
      }

      const data = await response.json();
      const botReply = data.candidates[0].content.parts[0].text;

      // Hiển thị phản hồi của bot
      const botMessage = document.createElement("div");
      botMessage.className = "message bot";
      botMessage.textContent = botReply;
      chatBody.appendChild(botMessage);

      // Cuộn xuống cuối
      chatBody.scrollTop = chatBody.scrollHeight;
    } catch (error) {
      const errorMessage = document.createElement("div");
      errorMessage.className = "message bot";
      errorMessage.textContent = "Có lỗi xảy ra. Vui lòng thử lại!";
      chatBody.appendChild(errorMessage);
      console.error(error);
    }
  }

  // Gửi tin nhắn khi nhấn Enter
  document.getElementById("user-input").addEventListener("keypress", (e) => {
    if (e.key === "Enter") {
      sendMessage();
    }
  });
</script>