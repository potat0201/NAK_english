{% load static %}
<!DOCTYPE html>
<html lang="en">
  {% include 'views/header.html' %}
  <style>
    .carousel-item img {
      width: 100vh;
      max-height: 95vh;
      object-fit: contain;
      overflow: hidden;
    }
    .carousel-inner {
      padding: 0;
      margin: 0;
    }

    .carousel-item {
      position: relative;
    }
  </style>
  <body>
    {% include 'views/navbar.html' %}
    <!-- header -->
    <div
      id="carouselExampleAutoplaying"
      class="carousel slide"
      data-bs-ride="carousel"
      data-bs-interval="3000"
    >
      <div class="carousel-inner">
        <div class="carousel-item active">
          <img
            src="{% static 'img/img/bannertong1.png' %}"
            class="d-block w-100"
            alt="..."
          />
        </div>
        <div class="carousel-item">
          <img
            src="{% static 'img/img/bannertong2.png' %}"
            class="d-block w-100"
            alt="..."
          />
        </div>
        <div class="carousel-item">
          <img
            src="{% static 'img/img/bannertong3.png' %}"
            class="d-block w-100"
            alt="..."
          />
        </div>
      </div>
      <button
        class="carousel-control-prev"
        type="button"
        data-bs-target="#carouselExampleIndicators"
        data-bs-slide="prev"
      >
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Previous</span>
      </button>
      <button
        class="carousel-control-next"
        type="button"
        data-bs-target="#carouselExampleIndicators"
        data-bs-slide="next"
      >
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Next</span>
      </button>
    </div>

    <!-- JavaScript và Bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>
    <div class="container main" style="margin-bottom: 200px">
      <div class="section">
        <img
          src="{% static '/img/img/Poster-You-Can-Do-It.png' %}"
          alt="Vi sao ban phai hoc tieng anh"
        />
        <div class="section-2">
          <h1 class="heading">
            <strong>Learn without limits and spread knowledge</strong>
          </h1>
          <br />
          <p class="doanvan">
            Khám phá những cơ hội mới với các khóa học, chứng chỉ và bằng cấp từ
            các trường đại học và doanh nghiệp hàng đầu. Dù bạn muốn thăng tiến
            trong sự nghiệp, học hỏi kỹ năng mới hay dẫn đầu trong thế giới cạnh
            tranh, chúng tôi luôn có tài nguyên phù hợp cho bạn. Bắt đầu hành
            trình của bạn ngay hôm nay!
          </p>
          <br />
          <div class="cta-group">
            <a href="#doraemon" class="signin" style="text-decoration: none"
              ><strong>See courses</strong></a
            >
            <button id="watch-video-btn" class="watch-video">
              <div class="icon">
                <img src="{% static 'img/icon/play-button.png' %}" alt="" />
              </div>
              <span><strong>Watch Video</strong></span>
            </button>
          </div>
          <!-- Popup video -->

          <!-- JavaScript -->
          <script>
            document.addEventListener("DOMContentLoaded", function () {
              const videoOverlay = document.getElementById("videoOverlay"); // videoOverlay id phần nền đen
              const videoFrame = document.getElementById("videoFrame"); // videoFrame id phần video
              const watchVideoButton =
                document.getElementById("watch-video-btn"); // Đảm bảo đúng ID nút

              // Khi nhấn "Watch Video", hiển thị popup & phát video
              watchVideoButton.addEventListener("click", function () {
                videoOverlay.style.display = "flex"; // Mở popup
                videoFrame.play(); // Bắt đầu phát
              });

              // Khi nhấn ra ngoài popup, đóng popup & dừng video
              videoOverlay.addEventListener("click", function (event) {
                if (event.target === videoOverlay) {
                  videoOverlay.style.display = "none"; // Ẩn popup
                  videoFrame.pause(); // Dừng phát video
                  videoFrame.currentTime = 0; // Đưa về giây 0
                }
              });
            });
          </script>
        </div>
      </div>
    </div>
    <div class="container">
      <div class="row align-items-center">
        <div class="col-md-6 text-start">
          <h2 id="doraemon"><strong>English for children</strong></h2>
          <br />
          <p class="doanvan">
            Ngày nay, tiếng Anh ngày càng trở nên quan trọng nhờ những lợi ích
            thiết thực mà nó mang lại trong học tập, công việc và cuộc sống.
            Nhiều trẻ em có thể giao tiếp tiếng Anh trôi chảy ngay từ nhỏ, giúp
            các em tự tin hơn và mở ra nhiều cơ hội trong tương lai. Chúng tôi ở
            đây để đồng hành cùng con bạn, giúp các em rèn luyện kỹ năng giao
            tiếp tiếng Anh một cách tự nhiên và truyền cảm hứng để các em yêu
            thích ngôn ngữ này hơn mỗi ngày!
          </p>
          <br />
          <div class="chihuong">
            <img
              src="{% static 'img/icon/caimuiten.png' %}"
              alt=""
              class="arrow"
            />
            <a
              href="/Children_English"
              class="signin"
              style="text-decoration: none"
              ><strong>Enjoy this course</strong></a
            >
          </div>
        </div>
        <div class="col-md-6 text-end">
          <img
            src="{% static 'img/img/trẻconhocta.jpg' %}"
            alt="trẻconhocta"
            class="img-fluid ms-auto d-block"
          />
        </div>
      </div>
    </div>
    <!-- Aldult English -->
    <div class="container text-center aldult">
      <div class="row">
        <div class="col">
          <img
            src="{% static 'img/img/adultenglish.webp' %}"
            alt="Mất gốc có học được tiếng Anh ?"
          />
        </div>
        <div class="col">
          <h2><strong>Adult's English</strong></h2>
          <br />
          <p class="doanvan">
            Bạn đang mất gốc tiếng Anh hoặc mong muốn giao tiếp tốt hơn để làm
            việc với đối tác, thăng tiến trong sự nghiệp? Nhưng bạn e ngại khi
            học tiếng Anh vì thiếu thời gian và nhiều lý do khác? Hãy tham gia
            ngay khóa học của chúng tôi – nơi giúp bạn học tiếng Anh dễ dàng,
            linh hoạt theo lịch trình của riêng mình. Đừng chần chừ, bắt đầu
            ngay hôm nay và đồng hành cùng chúng tôi!
          </p>
          <br />
          <div class="chihuong">
            <img
              src="{% static 'img/icon/caimuiten.png' %}"
              alt="Mũi tên"
              class="arrow"
            />
            <a
              href="/Adult_English"
              class="signin"
              style="text-decoration: none"
              ><strong>Enjoy this course</strong></a
            >
          </div>
        </div>
      </div>
    </div>
    <div class="container ielts-exam">
      <div class="row align-items-center">
        <div class="col-md-6 text-start">
          <h2><strong>Ielts Exam</strong></h2>
          <br />
          <p class="doanvan">
            Chúng tôi cung cấp bộ đề thi tham khảo IELTS chất lượng, bám sát cấu
            trúc đề thi thật, giúp bạn rèn luyện kỹ năng và làm quen với áp lực
            thời gian. Với hệ thống đề thi đa dạng, cập nhật thường xuyên theo
            xu hướng mới nhất, bạn sẽ có cơ hội thực hành hiệu quả cả bốn kỹ
            năng: Nghe, Nói, Đọc, Viết. Luyện tập với bộ đề của chúng tôi sẽ
            giúp bạn cải thiện chiến lược làm bài, nâng cao sự tự tin và sẵn
            sàng chinh phục kỳ thi IELTS!
          </p>
          <br />
          <div class="chihuong">
            <img
              src="{% static 'img/icon/caimuiten.png' %}"
              alt=""
              class="arrow"
            />
            <a
              href="./Children_English"
              class="signin"
              style="text-decoration: none"
              ><strong>Check now</strong></a
            >
          </div>
        </div>
        <div class="col-md-6 text-end">
          <img
            src="{% static 'img/img/ielts-exam.png' %}"
            alt="trẻconhocta"
            class="img-fluid ms-auto d-block"
          />
        </div>
      </div>
    </div>
    <!-- them anh cho dep -->
    <!-- footer  -->
    {% include 'views/footer.html' %}
  </body>
  <div class="video-popup" id="videoOverlay" style="display: none">
    <div class="video-container">
      <video id="videoFrame" width="100%" height="100%" controls>
        <source
          src="{% static 'video/videonakenglish.mp4' %}"
          type="video/mp4"
        />
        Trình duyệt của bạn không hỗ trợ video.
      </video>
    </div>
  </div>
</html>
<style>
  body {
    margin: 0;
    font-family: "Roboto", sans-serif;
    background-color: #f5f7fa;
  }

  /* Container cho chatbot */
  .chatbot-container {
    position: fixed;
    bottom: 30px;
    right: 30px;
    z-index: 1000;
  }

  /* Nút chatbot */
  .chatbot-button {
    width: 70px;
    height: 70px;
    background: linear-gradient(135deg, #007bff, #0056b3);
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    font-size: 28px;
    animation: pulse 2s infinite;
  }

  .chatbot-button:hover {
    transform: scale(1.1);
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.4);
  }

  /* Hiệu ứng pulse */
  @keyframes pulse {
    0% {
      box-shadow: 0 0 0 0 rgba(234, 116, 225, 0.7);
    }
    70% {
      box-shadow: 0 0 0 10px rgba(0, 123, 255, 0);
    }
    100% {
      box-shadow: 0 0 0 0 rgba(0, 123, 255, 0);
    }
  }

  /* Khung chat */
  .chatbot-window {
    width: 350px;
    height: 500px;
    background: #fff;
    border-radius: 20px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    display: none;
    flex-direction: column;
    position: absolute;
    bottom: 100px;
    right: 0;
    overflow: hidden;
    transform: scale(0.8);
    opacity: 0;
    transition: transform 0.3s ease, opacity 0.3s ease;
  }

  .chatbot-container.active .chatbot-window {
    display: flex;
    transform: scale(1);
    opacity: 1;
  }

  /* Header khung chat */
  .chatbot-header {
    font-family: "Honk", sans-serif;
    background: linear-gradient(to right, rgb(143, 227, 161), #3498db);
    color: black;
    padding: 15px;
    text-align: center;
    font-size: 36px;
    font-weight: 500;
    border-top-left-radius: 20px;
    border-top-right-radius: 20px;
  }

  /* Nội dung khung chat */
  .chatbot-body {
    flex: 1;
    padding: 20px;
    overflow-y: auto;
    background: #f0f4ff;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  /* Tin nhắn */
  .message {
    padding: 10px 15px;
    border-radius: 15px;
    max-width: 75%;
    line-height: 1.4;
    animation: slideIn 0.3s ease;
    white-space: pre-wrap; /* Hỗ trợ xuống dòng */
  }

  .message.user {
    background: pink;
    color: black;
    margin-left: auto;
    border-bottom-right-radius: 5px;
  }

  .message.bot {
    background: #e9ecef;
    color: #333;
    margin-right: auto;
    border-bottom-left-radius: 5px;
  }

  /* Hiệu ứng tin nhắn xuất hiện */
  @keyframes slideIn {
    from {
      transform: translateY(20px);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }

  /* Footer chứa input */
  .chatbot-footer {
    padding: 15px;
    background: #fff;
    border-top: 1px solid #e0e0e0;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .chatbot-footer input {
    flex: 1;
    padding: 12px;
    border: 1px solid #ddd;
    border-radius: 25px;
    outline: none;
    font-size: 14px;
    transition: border-color 0.3s ease;
  }

  .chatbot-footer input:focus {
    border-color: linear-gradient(to right, rgb(143, 227, 161), #3498db);
  }

  .chatbot-footer button {
    padding: 12px;
    background: linear-gradient(to right, rgb(143, 227, 161), #3498db);
    color: white;
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.3s ease;
  }

  .chatbot-footer button:hover {
    background: linear-gradient(to right, rgb(143, 227, 161), #3498db);
  }

  .chatbot-button img {
    width: 70px;
    height: 70px;
    object-fit: contain;
    border-radius: 50%;
  }

  /* Responsive */
  @media (max-width: 480px) {
    .chatbot-window {
      width: 90vw;
      height: 80vh;
      bottom: 80px;
      right: 10px;
    }

    .chatbot-button {
      width: 60px;
      height: 60px;
      font-size: 24px;
    }
  }
</style>
<div class="chatbot-container">
  <div class="chatbot-button">
    <img
      src="{% static 'img/img/479374583_2408177479537942_8679824344704556172_n (1).png' %}"
      alt="logooo"
      class="loggonak"
      style=""
    />
  </div>
  <div class="chatbot-window">
    <div class="chatbot-header">NAK ENGLISH</div>
    <div class="chatbot-body" id="chatbot-body">
      <div class="message bot" style="white-space: normal">
        <strong>Xin chào! Cùng học tập với NAK ENGLISH nhé 🙂</strong>
      </div>
    </div>
    <div class="chatbot-footer">
      <input
        type="text"
        id="user-input"
        placeholder="Nhập câu hoặc câu hỏi..."
      />
      <button onclick="sendMessage()">📤</button>
    </div>
  </div>
</div>

<script>
  const API_KEY = "AIzaSyDoBLRfWtl8RgD9bP_0YLocv1Ek-joFt1o";
  const API_URL = `https://generativelanguage.googleapis.com/v1/models/gemini-1.5-flash:generateContent?key=${API_KEY}`;

  const SYSTEM_PROMPT =
    "Bạn là một giáo viên tiếng Anh chuyên nghiệp. Nhiệm vụ của bạn là giúp người dùng học tiếng Anh bằng cách giải thích từ vựng, ngữ pháp, sửa lỗi câu, cung cấp ví dụ và trả lời các câu hỏi liên quan đến tiếng Anh. Phản hồi của bạn phụ thuộc vào việc nếu người dùng nói tiếng việt hãy phản hồi tiếng việt và nói tiếng anh khi người dùng nói tiếng anh, không chấp nhận các ngôn ngữ khác, dễ hiểu và thân thiện. Mỗi ý chính hoặc bước giải thích phải được trình bày trên một dòng mới, sử dụng gạch đầu dòng ('-') hoặc xuống dòng để đảm bảo rõ ràng và dễ đọc.";

  document.querySelector(".chatbot-button").addEventListener("click", () => {
    document.querySelector(".chatbot-container").classList.toggle("active");
  });

  async function sendMessage() {
    const input = document.getElementById("user-input");
    const message = input.value.trim();
    if (!message) return;

    // Hiển thị tin nhắn người dùng
    const chatBody = document.getElementById("chatbot-body");
    const userMessage = document.createElement("div");
    userMessage.className = "message user";
    userMessage.textContent = message;
    chatBody.appendChild(userMessage);
    input.value = "";

    // Cuộn xuống cuối
    chatBody.scrollTop = chatBody.scrollHeight;

    try {
      // Gửi yêu cầu đến Gemini API
      const response = await fetch(API_URL, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          contents: [
            {
              parts: [{ text: SYSTEM_PROMPT }, { text: message }],
            },
          ],
        }),
      });

      if (!response.ok) {
        throw new Error("Lỗi khi gọi Gemini API");
      }

      const data = await response.json();
      const botReply = data.candidates[0].content.parts[0].text;

      // Hiển thị phản hồi của bot
      const botMessage = document.createElement("div");
      botMessage.className = "message bot";
      botMessage.textContent = botReply;
      chatBody.appendChild(botMessage);

      // Cuộn xuống cuối
      chatBody.scrollTop = chatBody.scrollHeight;
    } catch (error) {
      const errorMessage = document.createElement("div");
      errorMessage.className = "message bot";
      errorMessage.textContent = "Có lỗi xảy ra. Vui lòng thử lại!";
      chatBody.appendChild(errorMessage);
      console.error(error);
    }
  }

  // Gửi tin nhắn khi nhấn Enter
  document.getElementById("user-input").addEventListener("keypress", (e) => {
    if (e.key === "Enter") {
      sendMessage();
    }
  });
</script>
